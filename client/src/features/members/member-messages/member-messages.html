<div class="flex flex-col w-full h-[72vh]">
  <div class="flex flex-col flex-grow overflow-auto">
    @for(msg of messageService.messageThread(); track msg.id) {
      <div
        class="chat"
        [class.chat-start]="!msg.currentUserSender"
        [class.chat-end]="msg.currentUserSender"
      >
        <div
          class="chat-image avatar"
          [class.avatar-online]="presenceService.onlineUsers().includes(msg.senderId || msg.recipientId)"
        >
          <div class="w-10 rounded-full">
            <img
              alt="image of user"
              [src]="msg.senderImageUrl || '/user.png'"
            />
          </div>
        </div>
        <div class="chat-header">
          {{msg.senderDisplayName}}
          <time class="text-xs opacity-50">{{msg.messageSent | date: 'short'}}</time>
        </div>
        <div class="chat-bubble">{{msg.content}}</div>
        @if (msg.currentUserSender && msg.dateRead) {
          <div class="chat-footer opacity-50">Seen {{msg.dateRead | timeAgo}}</div>
        } @else if (msg.currentUserSender && !msg.dateRead) {
          <div class="chat-footer opacity-50">Not read</div>
        } @else {
          <div class="chat-footer opacity-50">Delivered</div>
        }
      </div>
    }
    <div #messageEndRef></div>
  </div>
  <div class="flex join w-full">
    <input type="text"
        [(ngModel)]="messageContent"
        class="input w-full"
        placeholder="Type your message here..."
        (keydown.enter)="sendMessage()"
    />
    <button (click)="sendMessage()" class="btn btn-primary join-item" type="submit">Send</button>
  </div>
</div>
